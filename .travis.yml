os: windows
language: go
go: 1.14.x
script:
- pkger
- go build -o mars-game-windows.exe main.go
- ls
before_install:
- rm Makefile
- |-
  case $TRAVIS_OS_NAME in
    windows)
      [[ ! -f C:/tools/msys64/msys2_shell.cmd ]] && rm -rf C:/tools/msys64
      choco uninstall -y mingw
      choco upgrade --no-progress -y msys2
      export msys2='cmd //C RefreshEnv.cmd '
      export msys2+='& set MSYS=winsymlinks:nativestrict '
      export msys2+='& C:\\tools\\msys64\\msys2_shell.cmd -defterm -no-start'
      export mingw64="$msys2 -mingw64 -full-path -here -c "\"\$@"\" --"
      export msys2+=" -msys2 -c "\"\$@"\" --"
      $msys2 pacman --sync --noconfirm --needed mingw-w64-x86_64-toolchain
      ## Install more MSYS2 packages from https://packages.msys2.org/base here
      taskkill //IM gpg-agent.exe //F  # https://travis-ci.community/t/4967
      export PATH=/C/tools/msys64/mingw64/bin:$PATH
      export MAKE=mingw32-make  # so that Autotools can find it
      ;;
  esac
before_cache:
- |-
  case $TRAVIS_OS_NAME in
    windows)
      # https://unix.stackexchange.com/a/137322/107554
      $msys2 pacman --sync --clean --noconfirm
      ;;
  esac
cache:
  directories:
  - "$HOME/AppData/Local/Temp/chocolatey"
  - "/C/tools/msys64"
deploy:
  provider: releases
  api_key:
    secure: DDB4CdmqxKI2/EqNwg1cyM3/PuIeS2xu837xTSNpADesV/Rp3Ck/xxPbXFhWXxKm5ik3BLwBnJMrFB//1h0XHEw2CU4bU5r1A/Cb5SB+uaGL0w5qjAjM3+mePx+MqK2Mi2fyoualLPrysgQlcoKh2cu5UJlzgWqckdQMCOEZI6UvnNpxp9qe1WjyTr0S/fIsRMk9g1o62V+ymhUPFr3sxfCxbRdb5WJTFneFH+o8vDL5l/XAgJuBiu3VFizd5XYVxjZN70EK9KEbLMhmLi5sAVk/XsoLWkKYatuKS+WjOVQHBRcPSMO7HeO1B7A/xdexnsuQppjfsA3qRQ7tmFYpaJZ4FR+9xk3U3nkof6PmPrQWRS7ut5iLhJO4Xbg4LEz7aNLyCmmbyHysKNTqdKcWKgGxsYlUw/B8+KKaRgBEPZ3xc/GDxscW+9zWsaJqNy7Zx2/Ecr3OCWGEOO8UFA9X6xHi4RIILoETGZbQjycC4K2KQWAybExnNyj52OwMT6o/+nb/vQd9L/rAyyBm6OG9U4tdxj/S9MaGRqHzmkChVWur3t0gb686Pe7422wnnMv3X6Jw5fKyfbK4mGnjNS/NhUWPEz9lQ9Jzxp72Bp5WHqG3w7pQEV1NIuneQvIssTCEkn4uu62bc0u/AtEQFLkBFvBh5biKLBlRX1gVb3js5zg=
  file: mars-game-windows.exe
  skip_cleanup: true
  draft: true
